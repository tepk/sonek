<!DOCTYPE html>
<html>
<!DOCTYPE html>
<head>
    <title> Meteor Up - Documentation</title>
    <meta name="description" content="">
    <meta name="keywords" content="Meteor, JS, AWS, Deploy, Meteor Up, Meteor Deploy, JavaScript, SSH, VM, Virtual Machine">
    
    
    <!-- General Stuff you should have in head -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- End General Stuff -->    

    <!-- BootStrap: Latest compiled and minified CSS -->
    <link rel="stylesheet" href="/css/bootstrap.min.css" type="text/css" />
    <!-- Custom Theme and Bootstrap Overrides -->
    <link rel="stylesheet" href="/css/tocbot.css" type="text/css" />
    <link rel="stylesheet" href="/css/highlight.css" type="text/css" />
    <link rel="stylesheet" href="/css/custom.css" type="text/css" />
    <link rel="stylesheet" href="/css/docs.css" type="text/css" />
    
</head>

<body>
    <!-- Google Analytics -->
<script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-93931053-2', 'auto');
    ga('send', 'pageview');
</script>
<!-- End Google Analytics -->
<header>

    <nav class="fix-shadow">
        <div class="brand"><a href="/">Meteor Up</a></div>
        <ul class="nav-links">
            <li><a href="/getting-started.html">Tutorial</a></div>
            <li><a href="/docs.html">Docs</a></div>
            <li><a href="/plugins.html">Plugins</a></div>
        </ul>
    </nav>

    <!-- Added gitter Sidecar -->
    <script>
      ((window.gitter = {}).chat = {}).options = {
        room: 'meteor-up/Lobby'
      };
    </script>
    <script src="https://sidecar.gitter.im/dist/sidecar.v1.js" async defer></script>
    <!-- End Gitter Sidecar -->

    <a href="https://github.com/zodern/meteor-up" class="github-corner" aria-label="View source on Github">
        <svg width="80" height="80" viewBox="0 0 250 250" style="fill:#fff; color:#151513; position: absolute; top: 0; border: 0; right: 0;"
            aria-hidden="true">
            <path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path>
            <path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2"
                fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path>
            <path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z"
                fill="currentColor" class="octo-body"></path>
        </svg>
    </a>
    <style>
        .github-corner:hover .octo-arm {
            animation: octocat-wave 560ms ease-in-out
        }

        @keyframes octocat-wave {
            0%,
            100% {
                transform: rotate(0)
            }
            20%,
            60% {
                transform: rotate(-25deg)
            }
            40%,
            80% {
                transform: rotate(10deg)
            }
        }

        @media (max-width:500px) {
            .github-corner:hover .octo-arm {
                animation: none
            }
            .github-corner .octo-arm {
                animation: octocat-wave 560ms ease-in-out
            }
        }
    </style>
</header>

    <div id="docs-head" class="intro">
        <h1>Documentation</h1>
    </div>
    <div class="js-toc"></div>
    <div>
        <div class="col-sm-9 col-sm-push-3 docs-content">
              <div class="show-menu visible-xs-block">Docs Menu</div>
            <h2 id="server-configuration">Server Configuration</h2>

<ul>
  <li>Auto-restart if the app crashes</li>
  <li>Auto-start after server reboot</li>
  <li>Runs with docker for better security and isolation</li>
  <li>Reverts to the previous version if the deployment failed</li>
  <li>Pre-installed PhantomJS</li>
</ul>

<h2 id="installation">Installation</h2>

<div class="highlighter-rouge"><pre class="highlight"><code>npm install -g mup
</code></pre>
</div>

<p><code class="highlighter-rouge">mup</code> should be installed on the computer you are deploying from.</p>

<h2 id="creating-a-meteor-up-project">Creating a Meteor Up Project</h2>
<div class="highlighter-rouge"><pre class="highlight"><code>cd my-app-folder
mkdir .deploy
cd .deploy
mup init
</code></pre>
</div>

<p><strong><em>WARNING: Windows users need to use <code class="highlighter-rouge">mup.cmd</code> instead, as <code class="highlighter-rouge">mup</code> will result in unexpected behavior.</em></strong></p>

<p>This will create two files in your Meteor Up project directory:</p>

<ul>
  <li><code class="highlighter-rouge">mup.js</code> - Meteor Up configuration file</li>
  <li><code class="highlighter-rouge">settings.json</code> - Settings for Meteorâ€™s <a href="http://docs.meteor.com/#meteor_settings">settings API</a></li>
</ul>

<h2 id="example-configs">Example Configs</h2>
<!-- eslint comma-dangle: 0 -->
<h3 id="minimal-config">Minimal Config</h3>

<p>Just the required and most common options.</p>

<div class="language-js highlighter-rouge"><pre class="highlight"><code><span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="p">{</span>
  <span class="na">servers</span><span class="p">:</span> <span class="p">{</span>
    <span class="na">one</span><span class="p">:</span> <span class="p">{</span>
      <span class="na">host</span><span class="p">:</span> <span class="s1">'1.2.3.4'</span><span class="p">,</span>
      <span class="na">username</span><span class="p">:</span> <span class="s1">'root'</span><span class="p">,</span>
      <span class="na">pem</span><span class="p">:</span> <span class="s1">'~/.ssh/id_rsa'</span>
    <span class="p">}</span>
  <span class="p">},</span>
  <span class="na">app</span><span class="p">:</span> <span class="p">{</span>
    <span class="na">name</span><span class="p">:</span> <span class="s1">'Wekan'</span><span class="p">,</span>
    <span class="na">path</span><span class="p">:</span> <span class="s1">'../'</span><span class="p">,</span>
    <span class="na">docker</span><span class="p">:</span> <span class="p">{</span>
      <span class="na">image</span><span class="p">:</span> <span class="s1">'abernix/meteord:base'</span>
    <span class="p">},</span>
    <span class="na">servers</span><span class="p">:</span> <span class="p">{</span>
      <span class="na">one</span><span class="p">:</span> <span class="p">{}</span>
    <span class="p">},</span>
    <span class="na">buildOptions</span><span class="p">:</span> <span class="p">{</span>
      <span class="na">serverOnly</span><span class="p">:</span> <span class="kc">true</span>
    <span class="p">},</span>
    <span class="na">env</span><span class="p">:</span> <span class="p">{</span>
      <span class="na">ROOT_URL</span><span class="p">:</span> <span class="s1">'http://app.com'</span><span class="p">,</span>
      <span class="na">MONGO_URL</span><span class="p">:</span> <span class="s1">'mongodb://localhost/meteor'</span>
    <span class="p">}</span>
  <span class="p">},</span>
  <span class="na">mongo</span><span class="p">:</span> <span class="p">{</span>
    <span class="na">version</span><span class="p">:</span> <span class="s1">'3.4.1'</span><span class="p">,</span>
    <span class="na">servers</span><span class="p">:</span> <span class="p">{</span>
      <span class="na">one</span><span class="p">:</span> <span class="p">{}</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">};</span>
</code></pre>
</div>

<h3 id="everything-configured">Everything Configured</h3>

<div class="language-js highlighter-rouge"><pre class="highlight"><code><span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="p">{</span>
  <span class="na">servers</span><span class="p">:</span> <span class="p">{</span>
    <span class="na">one</span><span class="p">:</span> <span class="p">{</span>
      <span class="na">host</span><span class="p">:</span> <span class="s1">'1.2.3.4'</span><span class="p">,</span>
      <span class="na">username</span><span class="p">:</span> <span class="s1">'root'</span><span class="p">,</span>
      <span class="c1">// pem: '/home/user/.ssh/id_rsa',</span>
      <span class="c1">// password: 'password',</span>
      <span class="c1">// or leave blank to authenticate using ssh-agent</span>
      <span class="na">opts</span><span class="p">:</span> <span class="p">{</span>
        <span class="na">port</span><span class="p">:</span> <span class="mi">22</span>
      <span class="p">}</span>
    <span class="p">},</span>
    <span class="na">two</span><span class="p">:</span> <span class="p">{</span>
      <span class="na">host</span><span class="p">:</span> <span class="s1">'5.6.7.8'</span><span class="p">,</span>
      <span class="na">username</span><span class="p">:</span> <span class="s1">'root'</span><span class="p">,</span>
      <span class="na">pem</span><span class="p">:</span> <span class="s1">'~/.ssh/id_rsa'</span>
    <span class="p">},</span>
    <span class="na">three</span><span class="p">:</span> <span class="p">{</span>
      <span class="na">host</span><span class="p">:</span> <span class="s1">'2.3.4.5'</span><span class="p">,</span>
      <span class="na">username</span><span class="p">:</span> <span class="s1">'root'</span><span class="p">,</span>
      <span class="na">password</span><span class="p">:</span> <span class="s1">'password'</span>
    <span class="p">}</span>
  <span class="p">},</span>

  <span class="c1">// Formerly named 'meteor'. Configuration for deploying the app</span>
  <span class="na">app</span><span class="p">:</span> <span class="p">{</span>
    <span class="na">name</span><span class="p">:</span> <span class="s1">'app'</span><span class="p">,</span>
    <span class="na">path</span><span class="p">:</span> <span class="s1">'../app'</span><span class="p">,</span>
    <span class="c1">// (optional, default is meteor) Plugins can provide additional types</span>
    <span class="na">type</span><span class="p">:</span> <span class="s1">'meteor'</span><span class="p">,</span>

    <span class="c1">// lets you add docker volumes (optional). Can be used to</span>
    <span class="c1">// store files between app deploys and restarts.</span>
    <span class="na">volumes</span><span class="p">:</span> <span class="p">{</span>
      <span class="c1">// passed as '-v /host/path:/container/path' to the docker run command</span>
      <span class="s1">'/host/path'</span><span class="p">:</span> <span class="s1">'/container/path'</span><span class="p">,</span>
      <span class="s1">'/second/host/path'</span><span class="p">:</span> <span class="s1">'/second/container/path'</span>
    <span class="p">},</span>
    <span class="na">docker</span><span class="p">:</span> <span class="p">{</span>
      <span class="c1">// Change the image to 'kadirahq/meteord' if you</span>
      <span class="c1">// are using Meteor 1.3 or older</span>
      <span class="na">image</span><span class="p">:</span> <span class="s1">'abernix/meteord:base'</span><span class="p">,</span>

      <span class="c1">// lets you add/overwrite any parameter on</span>
      <span class="c1">// the docker run command (optional)</span>
      <span class="na">args</span><span class="p">:</span> <span class="p">[</span>
        <span class="c1">// linking example</span>
        <span class="s1">'--link=myCustomMongoDB:myCustomMongoDB'</span><span class="p">,</span>
        <span class="c1">// memory resvevation example</span>
        <span class="s1">'--memory-reservation 200M'</span>
      <span class="p">],</span>

      <span class="c1">// (optional) It is set to true when using a docker image</span>
      <span class="c1">// that supports it. Builds a new docker image containing the</span>
      <span class="c1">// app's bundle and npm dependencies to start the app faster and</span>
      <span class="c1">// make deploys more reliable and easier to troubleshoot</span>
      <span class="na">prepareBundle</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
      <span class="c1">// Additional docker build instructions, used during Prepare Bundle</span>
      <span class="na">buildInstructions</span><span class="p">:</span> <span class="p">[</span>
        <span class="s1">'RUN apt-get update &amp;&amp; apt-get install -y imagemagick'</span>
      <span class="p">],</span>
      <span class="c1">// (optional, default is true) If true, the app is stopped during</span>
      <span class="c1">// Prepare Bundle to help prevent running out of memory when building</span>
      <span class="c1">// the docker image. Set to false to reduce downtime if your server has</span>
      <span class="c1">// enough memory or swap.</span>
      <span class="na">stopAppDuringPrepareBundle</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>

      <span class="c1">// lets you bind the docker container to a</span>
      <span class="c1">// specific network interface (optional)</span>
      <span class="na">bind</span><span class="p">:</span> <span class="s1">'127.0.0.1'</span><span class="p">,</span>

      <span class="c1">// lets you add network connections to perform after run</span>
      <span class="c1">// (runs docker network connect &lt;net name&gt; for each network listed here)</span>
      <span class="na">networks</span><span class="p">:</span> <span class="p">[</span>
        <span class="s1">'net1'</span>
      <span class="p">]</span>
    <span class="p">},</span>

    <span class="c1">// list of servers to deploy to, from the 'servers' list</span>
    <span class="na">servers</span><span class="p">:</span> <span class="p">{</span>
      <span class="na">one</span><span class="p">:</span> <span class="p">{},</span>
      <span class="na">two</span><span class="p">:</span> <span class="p">{},</span>
      <span class="na">three</span><span class="p">:</span> <span class="p">{</span>
        <span class="c1">// Add or override env variables for specific servers (optional)</span>
        <span class="na">env</span><span class="p">:</span> <span class="p">{</span>
          <span class="na">PORT</span><span class="p">:</span> <span class="mi">5000</span>
        <span class="p">}</span>
      <span class="p">}</span>
    <span class="p">},</span>

    <span class="c1">// All options are optional.</span>
    <span class="na">buildOptions</span><span class="p">:</span> <span class="p">{</span>
      <span class="c1">// Set to true to skip building mobile apps</span>
      <span class="c1">// but still build the web.cordova architecture. (recommended)</span>
      <span class="na">serverOnly</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>

      <span class="c1">// Set to true to disable minification and bundling,</span>
      <span class="c1">// and include debugOnly packages</span>
      <span class="na">debug</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>

      <span class="c1">// defaults to a a folder in your tmp folder.</span>
      <span class="na">buildLocation</span><span class="p">:</span> <span class="s1">'/my/build/folder'</span><span class="p">,</span>

      <span class="c1">// Remove this property for mobileSettings to use your settings.json</span>
      <span class="na">mobileSettings</span><span class="p">:</span> <span class="p">{</span>
        <span class="na">yourMobileSetting</span><span class="p">:</span> <span class="s1">'setting value'</span>
      <span class="p">},</span>

      <span class="c1">// your app url for mobile app access</span>
      <span class="na">server</span><span class="p">:</span> <span class="s1">'http://app.com'</span><span class="p">,</span>

      <span class="c1">// When true, adds --allow-incompatible-updates arg to build command</span>
      <span class="na">allowIncompatibleUpdates</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>

      <span class="c1">// Executable used to build the meteor project</span>
      <span class="c1">// You can set to a local repo path if needed</span>
      <span class="na">executable</span><span class="p">:</span> <span class="s1">'meteor'</span>
    <span class="p">},</span>
    <span class="na">env</span><span class="p">:</span> <span class="p">{</span>
      <span class="c1">// If you are using SSL, this needs to start with https</span>
      <span class="na">ROOT_URL</span><span class="p">:</span> <span class="s1">'http://app.com'</span><span class="p">,</span>

      <span class="c1">// When using the built-in mongodb,</span>
      <span class="c1">// this is overwritten with the correct url</span>
      <span class="na">MONGO_URL</span><span class="p">:</span> <span class="s1">'mongodb://localhost/meteor'</span>

      <span class="c1">// The port you access the app on. (optional, default is 80)</span>
      <span class="c1">// PORT: 8000</span>

      <span class="c1">// The number of proxies in front of your server (optional, default is</span>
      <span class="c1">// 1 with reverse proxy, unused otherwise).</span>
      <span class="c1">// https://docs.meteor.com/api/connections.html</span>
      <span class="c1">// HTTP_FORWARDED_COUNT: 1</span>
    <span class="p">},</span>

    <span class="c1">// Docker log options (optional)</span>
    <span class="na">log</span><span class="p">:</span> <span class="p">{</span>
      <span class="na">driver</span><span class="p">:</span> <span class="s1">'syslog'</span><span class="p">,</span>
      <span class="na">opts</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">'syslog-address'</span><span class="p">:</span> <span class="s1">'udp://syslogserverurl.com:1234'</span>
      <span class="p">}</span>
    <span class="p">},</span>
    <span class="c1">// The maximum number of seconds it will wait</span>
    <span class="c1">// for your app to successfully start (optional, default is 60)</span>
    <span class="na">deployCheckWaitTime</span><span class="p">:</span> <span class="mi">60</span><span class="p">,</span>

    <span class="c1">// lets you define which port to check after the deploy process, if it</span>
    <span class="c1">// differs from the meteor port you are serving</span>
    <span class="c1">// (like meteor behind a proxy/firewall) (optional)</span>
    <span class="na">deployCheckPort</span><span class="p">:</span> <span class="mi">80</span><span class="p">,</span>

    <span class="c1">// Shows progress bar while uploading bundle to server</span>
    <span class="c1">// You might need to disable it on CI servers</span>
    <span class="c1">// (optional, default is false)</span>
    <span class="na">enableUploadProgressBar</span><span class="p">:</span> <span class="kc">true</span>
  <span class="p">},</span>

  <span class="c1">// (optional) Use built-in mongodb. Remove it to use a remote MongoDB</span>
  <span class="na">mongo</span><span class="p">:</span> <span class="p">{</span>
    <span class="c1">// (optional, default is 3.4.1) Version of MongoDB</span>
    <span class="na">version</span><span class="p">:</span> <span class="s1">'3.4.1'</span><span class="p">,</span>

    <span class="na">servers</span><span class="p">:</span> <span class="p">{</span>
      <span class="na">one</span><span class="p">:</span> <span class="p">{}</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">};</span>
</code></pre>
</div>

<h2 id="setting-up-a-server">Setting Up a Server</h2>

<div class="highlighter-rouge"><pre class="highlight"><code>mup setup
</code></pre>
</div>

<p>Running this locally will set up the remote servers you have specified in your config. It will take around 2-5 minutes depending on the serverâ€™s performance and network availability.</p>

<p>It is safe to run <code class="highlighter-rouge">mup setup</code> multiple times if needed. After making changes to custom SSL certificates, MongoDB, or servers in your config, you need to run <code class="highlighter-rouge">mup setup</code> for the changes to take effect.</p>

<h2 id="deploying-an-app">Deploying an App</h2>

<div class="language-bash highlighter-rouge"><pre class="highlight"><code>mup deploy
</code></pre>
</div>

<p>This will bundle the Meteor project locally and deploy it to the remote server(s). The bundling process is the same as what <code class="highlighter-rouge">meteor deploy</code> does.</p>

<div class="language-bash highlighter-rouge"><pre class="highlight"><code>mup deploy --cached-build
</code></pre>
</div>

<p>The <code class="highlighter-rouge">--cached-build</code> option will use the build from the last time you deployed the app. This is useful when the previous deploy failed from a network error or from a problem in the config.</p>

<h2 id="other-utility-commands">Other Utility Commands</h2>

<ul>
  <li><code class="highlighter-rouge">mup reconfig</code> - reconfigures app with new environment variables, Meteor settings, and it updates the start script. This is also the last step of <code class="highlighter-rouge">mup deploy</code>.</li>
  <li><code class="highlighter-rouge">mup stop</code> - stop the app</li>
  <li><code class="highlighter-rouge">mup start</code> - start the app</li>
  <li><code class="highlighter-rouge">mup restart</code> - restart the app</li>
  <li><code class="highlighter-rouge">mup logs [-f --tail=50]</code> - view the appâ€™s logs. Supports all of the flags from <code class="highlighter-rouge">docker logs</code>.</li>
</ul>

<h2 id="meteor-support">Meteor Support</h2>

<p>Mup supports Meteor 1.2 and newer, though you might need to change the docker image in your mup config.</p>

<table>
  <thead>
    <tr>
      <th>Meteor version</th>
      <th>Docker image</th>
      <th>Prepare Bundle</th>
      <th>Notes</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>1.2 - 1.3</td>
      <td><code class="highlighter-rouge">kadirahq/meteord</code></td>
      <td>false</td>
      <td>This is the default docker image. When using Meteor 1.2, <code class="highlighter-rouge">app.buildOptions.serverOnly</code> should be false.</td>
    </tr>
    <tr>
      <td>1.4 - 1.5</td>
      <td><code class="highlighter-rouge">abernix/meteord:base</code></td>
      <td>true</td>
      <td>Â </td>
    </tr>
    <tr>
      <td>1.6</td>
      <td><code class="highlighter-rouge">abernix/meteord:node-8.4.0-base</code></td>
      <td>true</td>
      <td>Â </td>
    </tr>
    <tr>
      <td>1.2 - 1.6</td>
      <td><code class="highlighter-rouge">zodern/meteor:root</code></td>
      <td>true</td>
      <td>Automatically uses the correct node version.</td>
    </tr>
  </tbody>
</table>

<p>When using an image that supports <code class="highlighter-rouge">Prepare Bundle</code>, deployments are easier to debug and more reliable.</p>

<h2 id="build-options">Build Options</h2>

<p>You can define Meteor build options in <code class="highlighter-rouge">mup.js</code> like this:</p>

<div class="language-ts highlighter-rouge"><pre class="highlight"><code><span class="p">...</span>
<span class="nl">app</span><span class="p">:</span> <span class="p">{</span>
  <span class="nl">buildOptions</span><span class="p">:</span> <span class="p">{</span>
    <span class="c1">// Set to true to disable minification and bundling,</span>
    <span class="c1">// and include debugOnly packages</span>
    <span class="nl">debug</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
    <span class="c1">// mobile setting for cordova apps</span>
    <span class="nx">mobileSettings</span><span class="err">:</span> <span class="p">{</span>
      <span class="nl">public</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">'meteor-up'</span><span class="err">:</span> <span class="s1">'rocks'</span><span class="p">,</span>
      <span class="p">}</span>
    <span class="p">},</span>
    <span class="c1">// executable used to build the meteor project</span>
    <span class="c1">// you can set a local repo path if needed</span>
    <span class="nx">executable</span><span class="err">:</span> <span class="s1">'meteor'</span><span class="p">,</span>
  <span class="p">}</span>
<span class="p">}</span>
<span class="p">...</span>
</code></pre>
</div>

<h2 id="additional-setupdeploy-information">Additional Setup/Deploy Information</h2>

<h3 id="deploy-wait-time">Deploy Wait Time</h3>

<p>Meteor Up checks if the deployment is successful or not just after the deployment. It will wait 15 seconds after starting the docker container before starting the checks.  The check runs every second until it either can successfully load the appâ€™s client, or it runs out of time as defined in <code class="highlighter-rouge">meteor.deployCheckWaitTime</code>.</p>

<h4 id="deploy-check-port">Deploy check port</h4>

<p>If you are deploying under a proxy/firewall and need a different port to be checked after deploy, add a variable called <code class="highlighter-rouge">deployCheckPort</code> with the value of the port you are publishing your application to.</p>

<div class="language-ts highlighter-rouge"><pre class="highlight"><code><span class="nx">app</span><span class="err">:</span> <span class="p">{</span>
 <span class="p">...</span>
  <span class="nl">deployCheckPort</span><span class="p">:</span> <span class="mi">80</span>
 <span class="p">...</span>
<span class="p">}</span>
</code></pre>
</div>

<h3 id="ssh-keys-with-passphrase-or-ssh-agent-support">SSH keys with passphrase (or ssh-agent support)</h3>

<blockquote>
  <p>This only tested with Mac/Linux</p>
</blockquote>

<p>Itâ€™s common to use passphrase enabled SSH keys to add an extra layer of protection to your SSH keys. You can use those keys with <code class="highlighter-rouge">mup</code> too. In order to do that, you need to use <code class="highlighter-rouge">ssh-agent</code>.</p>

<p>Hereâ€™s the process:</p>

<ul>
  <li>Remove the <code class="highlighter-rouge">pem</code> field from <code class="highlighter-rouge">mup.js</code> so your <code class="highlighter-rouge">mup.js</code> has <code class="highlighter-rouge">username</code> and <code class="highlighter-rouge">host</code> only.</li>
  <li>Start ssh agent with <code class="highlighter-rouge">eval $(ssh-agent)</code></li>
  <li>Add your ssh key with <code class="highlighter-rouge">ssh-add &lt;path-to-key&gt;</code></li>
  <li>Youâ€™ll be asked to enter the passphrase to the key</li>
  <li>After that, simply invoke <code class="highlighter-rouge">mup</code> commands and theyâ€™ll just work</li>
  <li>Once youâ€™ve deployed your app, kill ssh agent with <code class="highlighter-rouge">ssh-agent -k</code></li>
</ul>

<h3 id="ssh-based-authentication-with-sudo">SSH based authentication with <code class="highlighter-rouge">sudo</code></h3>

<p><strong>If your username is <code class="highlighter-rouge">root</code> or youâ€™re using AWS EC2, you donâ€™t need to follow these steps</strong></p>

<p>Please ensure your key file (pem) is not protected by a passphrase. This setup process will require NOPASSWD access to sudo. (Since Meteor needs port 80, sudo access is required.)</p>

<p>Make sure you also add your ssh key to the <code class="highlighter-rouge">/YOUR_USERNAME/.ssh/authorized_keys</code> list.</p>

<p>You can add your user to the sudo group:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>sudo adduser *username*  sudo
</code></pre>
</div>

<p>And you also need to add NOPASSWD to the sudoers file:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>sudo visudo

# replace this line
%sudo  ALL=(ALL) ALL

# by this line
%sudo ALL=(ALL) NOPASSWD:ALL
</code></pre>
</div>

<p>When this process is not working you might encounter the following error:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>'sudo: no tty present and no askpass program specified'
</code></pre>
</div>

<h3 id="server-setup-details">Server Setup Details</h3>

<p>Meteor Up uses Docker to run and manage your app. It uses <a href="https://github.com/meteorhacks/meteord">MeteorD</a> behind the scenes. Hereâ€™s how we manage and utilize the server.</p>

<ul>
  <li>Your currently running meteor bundle lives at <code class="highlighter-rouge">/opt/&lt;appName&gt;/current</code></li>
  <li>We have a demonized docker container running the above bundle</li>
  <li>The docker container is started with <code class="highlighter-rouge">--restart=always</code> flag and itâ€™ll re-spawn the container if it dies</li>
  <li>Logs are maintained via Docker</li>
  <li>If you decided to use MongoDB, it will be running as its own Docker container. Itâ€™s bound to the local interface and to port <code class="highlighter-rouge">27017</code> (you cannot access it from the outside)</li>
  <li>The database is named <code class="highlighter-rouge">&lt;appName&gt;</code></li>
</ul>

<h3 id="deploy-to-multiple-servers">Deploy to multiple servers</h3>

<p>Add all of the servers to the <code class="highlighter-rouge">servers</code> object and modify <code class="highlighter-rouge">app.servers</code> to include them.</p>

<h3 id="multiple-deployment-environments">Multiple Deployment Environments</h3>

<p>To deploy to <em>different</em> environments (e.g. staging, production, etc.), use separate Meteor Up configurations in separate directories, with each directory containing separate <code class="highlighter-rouge">mup.js</code> and <code class="highlighter-rouge">settings.json</code> files, and set the <code class="highlighter-rouge">app.path</code> field in each config to point back to your appâ€™s directory.</p>

<h3 id="multiple-deployments">Multiple Deployments</h3>

<p>Meteor Up supports multiple deployments to a single server. To route requests to the correct app, use the <a href="#reverse-proxy">reverse proxy</a>.</p>

<p>Letâ€™s assume we need to deploy production and staging versions of the app to the same server. The production is at myapp.com, and staging is at staging.myapp.com.</p>

<p>We need to have two separate Meteor Up projects. For that, create two directories, initialize Meteor Up, and add the necessary configurations.</p>

<p>In the staging <code class="highlighter-rouge">mup.js</code>, change the field <code class="highlighter-rouge">app.name</code> to have the value <code class="highlighter-rouge">staging</code>. You can add any name you prefer instead of <code class="highlighter-rouge">staging</code>.</p>

<p>Next, add the proxy object to both configs. For your production app, it would be:</p>

<div class="language-js highlighter-rouge"><pre class="highlight"><code><span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="p">{</span>
  <span class="c1">// ... rest of config</span>

  <span class="na">proxy</span><span class="p">:</span> <span class="p">{</span>
    <span class="na">domains</span><span class="p">:</span> <span class="s1">'myapp.com'</span>
  <span class="p">}</span>
<span class="p">};</span>
</code></pre>
</div>

<p>For the staging app, <code class="highlighter-rouge">proxy.domains</code> would be <code class="highlighter-rouge">staging.myapp.com</code>.</p>

<p>Now, set up both projects and deploy the apps.</p>

<h2 id="docker-options">Docker options</h2>

<h3 id="customize-docker-image">Customize docker image</h3>

<p>During <code class="highlighter-rouge">Prepare Bundle</code>, mup builds a new docker image that includes your appâ€™s code. You can customize this image by adding additional build instructions that are run before adding your app. This can be used to install dependencies your app needs, such as adding <code class="highlighter-rouge">imagemagick</code> or node-canvasâ€™s dependencies.</p>

<p>You can add instructions with <code class="highlighter-rouge">app.docker.buildInstructions</code>. An example is:</p>
<div class="language-js highlighter-rouge"><pre class="highlight"><code><span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="p">{</span>
  <span class="na">app</span><span class="p">:</span> <span class="p">{</span>
    <span class="na">name</span><span class="p">:</span> <span class="s1">'app'</span><span class="p">,</span>
    <span class="na">path</span><span class="p">:</span> <span class="s1">'../'</span><span class="p">,</span>
    <span class="na">servers</span><span class="p">:</span> <span class="p">{</span> <span class="na">one</span><span class="p">:</span> <span class="p">{}</span> <span class="p">},</span>
    <span class="na">docker</span><span class="p">:</span> <span class="p">{</span>
      <span class="na">buildInstructions</span><span class="p">:</span> <span class="p">[</span>
        <span class="s1">'RUN apt-get update &amp;&amp; apt-get install -y imagemagick'</span>
      <span class="p">]</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">};</span>
</code></pre>
</div>

<p>Each item is added on a new line in the <code class="highlighter-rouge">Dockerfile</code>, and should start with <code class="highlighter-rouge">RUN</code>, <code class="highlighter-rouge">USER</code>, or another dockerfile instruction.
If the base docker image runs the app as a non-root user, you might need to switch the user to root for your RUN commands, and back to the non-root user afterwards.</p>

<p>After changing the config, run <code class="highlighter-rouge">mup deploy</code>.</p>

<h3 id="listening-to-specific-ip-address-ip-binding">Listening to specific IP address (IP Binding)</h3>

<p>If you want Docker to listen only on a specific network interface, such as <code class="highlighter-rouge">127.0.0.1</code>, add a variable called <code class="highlighter-rouge">bind</code> with the value of the IP address you want to listen to.</p>

<div class="language-ts highlighter-rouge"><pre class="highlight"><code><span class="nx">app</span><span class="err">:</span> <span class="p">{</span>
 <span class="p">...</span>
 <span class="nl">docker</span><span class="p">:</span> <span class="p">{</span>
  <span class="p">...</span>
  <span class="nl">bind</span><span class="p">:</span> <span class="s1">'127.0.0.1'</span>
  <span class="p">...</span>
 <span class="p">}</span>
<span class="p">}</span>
</code></pre>
</div>

<h3 id="docker-networks">Docker networks</h3>

<p>If you need to connect your docker container to one or more networks add a variable called <code class="highlighter-rouge">networks</code> inside the docker configuration. This is an array containing all network names to which it has to connect.</p>

<div class="language-ts highlighter-rouge"><pre class="highlight"><code><span class="nx">app</span><span class="err">:</span> <span class="p">{</span>
 <span class="p">...</span>
  <span class="nl">docker</span><span class="p">:</span> <span class="p">{</span>
    <span class="p">...</span>
    <span class="nl">networks</span><span class="p">:</span> <span class="p">[</span>
      <span class="s1">'myNetwork1'</span>
    <span class="p">]</span>
    <span class="p">...</span>
  <span class="p">}</span>
 <span class="p">...</span>
<span class="p">}</span>
</code></pre>
</div>

<h3 id="custom-docker-registry">Custom Docker Registry</h3>

<p>Simply reference the docker image by url in the <code class="highlighter-rouge">meteor.docker.image</code> setting:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>app: {
 ...
  docker: {
    ...
    image: 'registry.gitlab.com/someregistry/someimage:sometag'
  }
}
</code></pre>
</div>

<p>And then add a docker setup hook to login to your private registry on the server. See <a href="#hooks">Hooks</a> for example of logging into a private docker registry.</p>

<h3 id="image-port">Image Port</h3>

<p>You can set <code class="highlighter-rouge">meteor.docker.imagePort</code> to the port to expose from the container. This does not affect the port the app is accessed on, only the port the app runs on inside the docker container.</p>

<h2 id="reverse-proxy">Reverse Proxy</h2>

<p>Meteor Up can create a nginx reverse proxy that will handle SSL, and, if you are running multiple apps on the server, it will route requests to the correct app. The proxy is shared between all apps on the servers.</p>

<p>This replaces the former nginx setup, configured using <code class="highlighter-rouge">meteor.ssl</code> and <code class="highlighter-rouge">meteor.nginx</code>.</p>

<p>Remove <code class="highlighter-rouge">meteor.ssl</code> and <code class="highlighter-rouge">meteor.nginx</code> from your config and add a <code class="highlighter-rouge">proxy</code> section:</p>

<div class="language-js highlighter-rouge"><pre class="highlight"><code><span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="p">{</span>
  <span class="c1">// ... rest of config</span>

  <span class="na">proxy</span><span class="p">:</span> <span class="p">{</span>
    <span class="c1">// comma-separated list of domains your website</span>
    <span class="c1">// will be accessed at.</span>
    <span class="c1">// You will need to configure your DNS for each one.</span>
    <span class="na">domains</span><span class="p">:</span> <span class="s1">'website.com,www.website.com'</span>
  <span class="p">}</span>
<span class="p">};</span>
</code></pre>
</div>

<p>The first time you setup the reverse proxy, you need to stop every app running on the servers:</p>
<div class="language-bash highlighter-rouge"><pre class="highlight"><code>mup stop
</code></pre>
</div>

<p>Then, run</p>
<div class="language-bash highlighter-rouge"><pre class="highlight"><code>mup setup
mup reconfig
</code></pre>
</div>

<h3 id="ssl">SSL</h3>
<p>Add an <code class="highlighter-rouge">ssl</code> object to your <code class="highlighter-rouge">proxy</code> config:</p>
<div class="language-js highlighter-rouge"><pre class="highlight"><code><span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="p">{</span>
  <span class="c1">// ... rest of config</span>

  <span class="na">proxy</span><span class="p">:</span> <span class="p">{</span>
    <span class="na">domains</span><span class="p">:</span> <span class="s1">'website.com,www.website.com'</span><span class="p">,</span>
    <span class="na">ssl</span><span class="p">:</span> <span class="p">{</span>
      <span class="c1">// Enable let's encrypt to create free certificates.</span>
      <span class="c1">// The email is used by Let's Encrypt to notify you when the</span>
      <span class="c1">// certificates are close to expiring.</span>
      <span class="na">letsEncryptEmail</span><span class="p">:</span> <span class="s1">'email@domain.com'</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">};</span>
</code></pre>
</div>

<p>For Letâ€™s Encrypt to work, you also need to:</p>
<ol>
  <li>Make sure <code class="highlighter-rouge">meteor.env.ROOT_URL</code> starts with <code class="highlighter-rouge">https://</code></li>
  <li>Setup DNS for each of the domains in <code class="highlighter-rouge">proxy.domains</code> to point to the server</li>
  <li>Open port 80 if it isnâ€™t. That port is used to verify that you control the domain.</li>
</ol>

<p>After changing the config, run <code class="highlighter-rouge">mup setup</code> and <code class="highlighter-rouge">mup reconfig</code>. It will automatically create the certificates and setup SSL, which can take up to a few minutes. The certificates will be automatically renewed when they expire within 30 days.</p>

<p>If you are using custom certificates instead, it would look like:</p>
<div class="language-js highlighter-rouge"><pre class="highlight"><code><span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="p">{</span>
  <span class="c1">// .. rest of config</span>

  <span class="na">proxy</span><span class="p">:</span> <span class="p">{</span>
    <span class="na">domains</span><span class="p">:</span> <span class="s1">'website.com,www.website.com'</span><span class="p">,</span>
    <span class="na">ssl</span><span class="p">:</span> <span class="p">{</span>
      <span class="na">crt</span><span class="p">:</span> <span class="s1">'./bundle.crt'</span><span class="p">,</span>
      <span class="na">key</span><span class="p">:</span> <span class="s1">'./private.pem'</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">};</span>
</code></pre>
</div>
<p>Then run <code class="highlighter-rouge">mup setup</code>.</p>

<p>You can view the list of certificates and when they expire by running <code class="highlighter-rouge">mup status</code>.</p>

<h3 id="redirect-http-to-https">Redirect http to https</h3>

<p>In your config, add:</p>
<div class="language-js highlighter-rouge"><pre class="highlight"><code><span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="p">{</span>
  <span class="c1">// ... rest of config</span>

  <span class="na">proxy</span><span class="p">:</span> <span class="p">{</span>
    <span class="na">domains</span><span class="p">:</span> <span class="s1">'website.com,www.website.com'</span><span class="p">,</span>
    <span class="na">ssl</span><span class="p">:</span> <span class="p">{</span>
      <span class="na">forceSSL</span><span class="p">:</span> <span class="kc">true</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">};</span>
</code></pre>
</div>

<p>It uses HSTS. This means that if you set it to <code class="highlighter-rouge">false</code> after itâ€™s been true, the browser used by anyone that visited it while it was set to true will still be redirected to <code class="highlighter-rouge">https</code> for one year.</p>

<h3 id="custom-nginx-config">Custom NGINX Config</h3>

<p>The nginx config is generated based on the docker containers running on the same server. At this time, it is not possible to modify the majority it. However, you can modify the server and <code class="highlighter-rouge">/</code> location blocks for the app. It is also possible to add a config that is used proxy-wide, and can add additional <code class="highlighter-rouge">upstream</code> and <code class="highlighter-rouge">server</code> blocks.</p>

<p>To extend the server block for the app, save the rules to a file and add the path to your config:</p>

<div class="language-js highlighter-rouge"><pre class="highlight"><code><span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="p">{</span>
  <span class="c1">// ... rest of config</span>

  <span class="na">proxy</span><span class="p">:</span> <span class="p">{</span>
    <span class="na">domains</span><span class="p">:</span> <span class="s1">'website.com'</span><span class="p">,</span>
    <span class="na">nginxServerConfig</span><span class="p">:</span> <span class="s1">'./path/to/config'</span>
  <span class="p">}</span>
<span class="p">};</span>
</code></pre>
</div>

<p>To modify the <code class="highlighter-rouge">/</code> location block, save the rules to a file and add the path to your config:</p>

<div class="language-js highlighter-rouge"><pre class="highlight"><code><span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="p">{</span>
  <span class="c1">// ... rest of config</span>

  <span class="na">proxy</span><span class="p">:</span> <span class="p">{</span>
    <span class="na">domains</span><span class="p">:</span> <span class="s1">'website.com'</span><span class="p">,</span>
    <span class="na">nginxLocationConfig</span><span class="p">:</span> <span class="s1">'./path/to/config'</span>
  <span class="p">}</span>
<span class="p">};</span>
</code></pre>
</div>

<p>To learn about the nginx config used proxy-wide, look at the <code class="highlighter-rouge">proxy.shared</code> example in the <a href="#advanced-configuration"><code class="highlighter-rouge">advanced configuration</code></a> docs.</p>

<p>You can view the generated config by running</p>

<div class="language-bash highlighter-rouge"><pre class="highlight"><code>mup proxy nginx-config
</code></pre>
</div>

<p>There will be <code class="highlighter-rouge">include</code> statements for each custom config.</p>

<h3 id="advanced-configuration">Advanced configuration</h3>

<p>These are additional options that can be used to customize the reverse proxy. The defaults are compatible with most apps.</p>

<div class="language-js highlighter-rouge"><pre class="highlight"><code><span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="p">{</span>
  <span class="c1">// ... rest of config</span>

  <span class="na">proxy</span><span class="p">:</span> <span class="p">{</span>
    <span class="na">domains</span><span class="p">:</span> <span class="s1">'website.com,www.website.com'</span><span class="p">,</span>

    <span class="c1">// (optional, default=10M) Limit for the size of file uploads.</span>
    <span class="c1">// Set to 0 disables the limit.</span>
    <span class="na">clientUploadLimit</span><span class="p">:</span> <span class="s1">'50M'</span>
  <span class="p">}</span>
<span class="p">};</span>
</code></pre>
</div>

<p>The <code class="highlighter-rouge">proxy.shared</code> object has settings that most apps wonâ€™t need to change, but if they are they apply to every app using the proxy. After you change <code class="highlighter-rouge">proxy.shared</code>, you need to run <code class="highlighter-rouge">mup proxy reconfig-shared</code> for it to take effect.</p>

<div class="language-js highlighter-rouge"><pre class="highlight"><code><span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="p">{</span>
  <span class="c1">// ... rest of config</span>

  <span class="na">proxy</span><span class="p">:</span> <span class="p">{</span>
    <span class="na">domains</span><span class="p">:</span> <span class="s1">'website.com,www.website.com'</span><span class="p">,</span>

    <span class="c1">// Settings in "proxy.shared" will be applied to every app</span>
    <span class="c1">// deployed on the servers using the reverse proxy.</span>
    <span class="c1">// Everything is optional.</span>
    <span class="c1">// After changing this object, run `mup proxy reconfig-shared`</span>
    <span class="na">shared</span><span class="p">:</span> <span class="p">{</span>
      <span class="c1">// The port number to listen to for http connections. Default 80.</span>
      <span class="na">httpPort</span><span class="p">:</span> <span class="mi">80</span><span class="p">,</span>
      <span class="c1">// The port to listen for https connections. Default is 443.</span>
      <span class="na">httpsPort</span><span class="p">:</span> <span class="mi">443</span><span class="p">,</span>
      <span class="c1">// Add an nginx config that is used proxy-wide.</span>
      <span class="c1">// This config can add additional upstream and server blocks if needed.</span>
      <span class="na">nginxConfig</span><span class="p">:</span> <span class="s1">'./path/to/config'</span><span class="p">,</span>
      <span class="c1">// Environment variables for nginx proxy</span>
      <span class="na">env</span><span class="p">:</span> <span class="p">{</span>
        <span class="na">DEFAULT_HOST</span><span class="p">:</span> <span class="s1">'foo.bar.com'</span>
      <span class="p">},</span>
      <span class="c1">// env for the jrcs/letsencrypt-nginx-proxy-companion container</span>
      <span class="na">envLetsEncrypt</span><span class="p">:</span> <span class="p">{</span>
        <span class="c1">// Directory URI for the CA ACME API endpoint</span>
        <span class="c1">// (default: https://acme-v01.api.letsencrypt.org/directory).</span>
        <span class="c1">// If you set it's value to</span>
        <span class="c1">// https://acme-staging.api.letsencrypt.org/directory</span>
        <span class="c1">// letsencrypt will use test servers that</span>
        <span class="c1">// don't have the 5 certs/week/domain limits.</span>
        <span class="na">ACME_CA_URI</span><span class="p">:</span> <span class="s1">'https://acme-v01.api.letsencrypt.org/directory'</span><span class="p">,</span>

        <span class="c1">// Set it to true to enable debugging of the entrypoint script and</span>
        <span class="c1">// generation of LetsEncrypt certificates,</span>
        <span class="c1">// which could help you pin point any configuration issues.</span>
        <span class="na">DEBUG</span><span class="p">:</span> <span class="kc">true</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">};</span>
</code></pre>
</div>

<h2 id="changing-the-apps-name">Changing the Appâ€™s Name</h2>

<p>Itâ€™s okay to change <code class="highlighter-rouge">app.name</code>. But before you do so, you need to stop the project with older <code class="highlighter-rouge">appName</code>. Also, if you use the built-in MongoDB, mup will create a new database with the new name so you will need to migrate the data.</p>

<ol>
  <li>Run <code class="highlighter-rouge">mup stop</code></li>
  <li>Change the app name in the config</li>
  <li>Run <code class="highlighter-rouge">mup setup</code> and <code class="highlighter-rouge">mup deploy</code></li>
</ol>

<h2 id="custom-configuration-and-settings-files">Custom configuration and settings files</h2>

<p>You can keep multiple configuration and settings files in the same directory and pass them to mup using the command parameters <code class="highlighter-rouge">--settings</code> and <code class="highlighter-rouge">--config</code>. For example, to use a file <code class="highlighter-rouge">mup-staging.js</code> and <code class="highlighter-rouge">staging-settings.json</code>, add the parameters like this:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>mup deploy --config=mup-staging.js --settings=staging-settings.json
</code></pre>
</div>

<h2 id="ssl-support">SSL Support</h2>

<p><strong>This is depreciated. Use the <a href="#ssl">reverse proxy</a> to setup ssl instead.</strong></p>

<p>Meteor UP can enable SSL support for your app. It can either autogenerate the certificates or upload them from your dev computer.</p>

<h3 id="autogenerate-certificates">Autogenerate certificates</h3>

<p><strong>This is depreciated. Use the <a href="#ssl">reverse proxy</a> to setup ssl instead.</strong></p>

<p>Meteor Up can use Letâ€™s Encrypt to generate certificates for you. Add the following to your <code class="highlighter-rouge">mup.js</code> file:</p>

<div class="language-ts highlighter-rouge"><pre class="highlight"><code><span class="nx">app</span><span class="err">:</span> <span class="p">{</span>
  <span class="p">...</span>
  <span class="nl">ssl</span><span class="p">:</span> <span class="p">{</span>
    <span class="nl">autogenerate</span><span class="p">:</span> <span class="p">{</span>
      <span class="nl">email</span><span class="p">:</span> <span class="s1">'email.address@domain.com'</span><span class="p">,</span>
      <span class="nx">domains</span><span class="err">:</span> <span class="s1">'website.com,www.website.com'</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>

</code></pre>
</div>

<p>You also need to:</p>
<ol>
  <li>Make sure <code class="highlighter-rouge">meteor.env.ROOT_URL</code> starts with <code class="highlighter-rouge">https://</code></li>
  <li>Set up DNS for each of the domains in <code class="highlighter-rouge">meteor.ssl.autogenerate.domains</code></li>
</ol>

<p>Then run <code class="highlighter-rouge">mup deploy</code>. It will automatically create certificates and set up SSL, which can take up to a few minutes. The certificates will be automatically renewed when they expire within 30 days.</p>

<h3 id="upload-certificates">Upload certificates</h3>

<p><strong>This is depreciated. Use the <a href="#ssl">reverse proxy</a> to setup ssl instead.</strong></p>

<p>To upload certificates instead of having the server generate them for you, just add the following configuration to your <code class="highlighter-rouge">mup.js</code> file.</p>

<div class="language-ts highlighter-rouge"><pre class="highlight"><code><span class="nx">app</span><span class="err">:</span> <span class="p">{</span>
  <span class="p">...</span>
  <span class="nl">ssl</span><span class="p">:</span> <span class="p">{</span>
    <span class="nl">crt</span><span class="p">:</span> <span class="s1">'./bundle.crt'</span><span class="p">,</span> <span class="c1">// this is a bundle of certificates</span>
    <span class="nx">key</span><span class="err">:</span> <span class="s1">'./private.key'</span><span class="p">,</span> <span class="c1">// this is the private key of the certificate</span>
    <span class="nx">port</span><span class="err">:</span> <span class="mi">443</span> <span class="c1">// 443 is the default value and it's the standard HTTPS port</span>
  <span class="p">}</span>
  <span class="p">...</span>
<span class="p">}</span>
</code></pre>
</div>

<p>Now simply do <code class="highlighter-rouge">mup setup</code> and then <code class="highlighter-rouge">mup deploy</code>. Your app is now running with a modern SSL setup.</p>

<p>If your certificate and key are already in the right location on your server and you would like to prevent Mup from overriding them while still needing an SSL setup, you can add <code class="highlighter-rouge">upload: false</code> in the <code class="highlighter-rouge">meteor.ssl</code> object.</p>

<p>To learn more about SSL setup when using your own certificates, refer to the <a href="https://github.com/meteorhacks/mup-frontend-server"><code class="highlighter-rouge">mup-frontend-server</code></a> project.</p>

<h2 id="nginx-upload">Nginx Upload</h2>

<p><strong>This is depreciated. Use the <a href="#ssl">reverse proxy</a> to configure this instead.</strong></p>

<p><strong><em>This Only Works if you are using the Letâ€™s Encrypt Autogenerated SSLâ€™s</em></strong></p>

<p>If you would like to increase the client upload limits, you can change it by adding:</p>
<div class="language-ts highlighter-rouge"><pre class="highlight"><code>
<span class="nl">app</span><span class="p">:</span> <span class="p">{</span>
   <span class="p">...</span>
   <span class="nl">nginx</span><span class="p">:</span> <span class="p">{</span>
     <span class="nl">clientUploadLimit</span><span class="p">:</span> <span class="s1">'&lt;desired amount&gt;'</span> <span class="c1">// Default is 10M</span>
   <span class="p">}</span>
   <span class="p">...</span>
<span class="p">}</span>

</code></pre>
</div>

<h2 id="mongodb">MongoDB</h2>

<h3 id="external-database">External Database</h3>

<p>To use an external database:</p>

<ol>
  <li>Remove the <code class="highlighter-rouge">mongo</code> object from your config</li>
  <li>Set <code class="highlighter-rouge">meteor.env.MONGO_URL</code> to point to the external Mongo instance</li>
</ol>

<p>Two popular Mongo DbaaSâ€™s are <a href="https://www.compose.com/mongodb">Compose</a> and <a href="https://mlab.com/">mLab</a>.</p>

<h3 id="built-in-database">Built-in Database</h3>
<p>Meteor Up can start a MongoDB instance on the server and set <code class="highlighter-rouge">meteor.env.MONGO_URL</code> to connect to it.</p>

<p>It is recommended to use an external database instead of the one built-in to mup for apps in production. The built-in database is not easy to backup, and only works when the app is running on one server.</p>

<p>Add the <code class="highlighter-rouge">mongo</code> object to your config:</p>

<div class="language-js highlighter-rouge"><pre class="highlight"><code><span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="p">{</span>
  <span class="c1">// .. rest of config</span>

  <span class="na">mongo</span><span class="p">:</span> <span class="p">{</span>
    <span class="na">version</span><span class="p">:</span> <span class="s1">'3.4.1'</span><span class="p">,</span>
    <span class="na">servers</span><span class="p">:</span> <span class="p">{</span>
      <span class="na">one</span><span class="p">:</span> <span class="p">{}</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">};</span>
</code></pre>
</div>

<p>To use the oplog, set <code class="highlighter-rouge">app.env.MONGO_OPLOG_URL</code> to <code class="highlighter-rouge">mongodb://mongodb/local</code>.</p>

<p>Before your first setup, it is recommended to change <code class="highlighter-rouge">mongo.version</code> to the newest version of MongoDB your app or meteor supports. After Mongo is started, it is more complex to upgrade it.</p>

<p>After you finished changing the config, run</p>
<div class="language-bash highlighter-rouge"><pre class="highlight"><code>mup setup
</code></pre>
</div>

<p>and</p>
<div class="language-bash highlighter-rouge"><pre class="highlight"><code>mup deploy
</code></pre>
</div>

<h3 id="multiple-apps-use-the-same-database">Multiple apps use the same database</h3>
<p>It is possible for two apps to use the same database from the built-in MongoDB instance.</p>

<p>In the config for one of the apps, follow the instructions for <a href="#built-in-database">Built-in Database</a>.</p>

<p>For the other apps:</p>
<ol>
  <li>Make sure the <code class="highlighter-rouge">mongo</code> object is not in the config</li>
  <li>Change <code class="highlighter-rouge">env.MONGO_URL</code> to <code class="highlighter-rouge">mongodb://mongodb:27017/&lt;app1 name&gt;</code></li>
  <li>Change <code class="highlighter-rouge">meteor.docker.args</code> to <code class="highlighter-rouge">[ '--link=mongodb:mongodb' ]</code>. <code class="highlighter-rouge">meteor.docker</code> will look similar to:</li>
</ol>

<div class="language-ts highlighter-rouge"><pre class="highlight"><code>    <span class="nx">docker</span><span class="err">:</span> <span class="p">{</span>
      <span class="c1">// change to 'kadirahq/meteord' if your app is using Meteor 1.3 or older</span>
      <span class="nl">image</span><span class="p">:</span> <span class="s1">'abernix/meteord:base'</span><span class="p">,</span>
      <span class="nx">args</span><span class="err">:</span> <span class="p">[</span>
        <span class="s1">'--link=mongodb:mongodb'</span>
      <span class="p">]</span>
    <span class="p">}</span>
</code></pre>
</div>

<h3 id="accessing-the-database">Accessing the Database</h3>

<p>You canâ€™t access the MongoDB from outside the server. To access the MongoDB shell you need to log into your server via SSH first and then run the following command:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>docker exec -it mongodb mongo &lt;appName&gt;
</code></pre>
</div>

<h3 id="view-mongodb-logs">View MongoDB Logs</h3>

<p>If you are experiencing problems with MongoDB (such as it frequently restarting), you can view the logs with</p>

<div class="language-bash highlighter-rouge"><pre class="highlight"><code>mup mongo logs
</code></pre>
</div>

<h3 id="backup-and-restore">Backup and restore</h3>

<p>For backup you can use:</p>
<div class="language-sh highlighter-rouge"><pre class="highlight"><code>ssh root@host <span class="s2">"docker exec mongodb mongodump -d meteor --archive --gzip"</span> &gt; dump.gz
</code></pre>
</div>
<p>and for restore:</p>
<div class="language-sh highlighter-rouge"><pre class="highlight"><code>cat dump.gz | ssh root@host <span class="s2">"cat | docker exec -i mongodb mongorestore --archive --gzip"</span> <span class="c"># use --drop if you want to drop existing collections first</span>
</code></pre>
</div>

<h3 id="change-mongodb-version">Change MongoDB Version</h3>

<p>If you have not deployed to the server, you can change the mongo version by adding:</p>

<div class="language-ts highlighter-rouge"><pre class="highlight"><code>
<span class="nl">mongo</span><span class="p">:</span> <span class="p">{</span>
  <span class="p">...</span>
  <span class="nl">version</span><span class="p">:</span> <span class="s1">'&lt;desired version&gt;'</span>
<span class="p">}</span>

</code></pre>
</div>

<p>If you have deployed to the server, it involves a couple more steps.</p>

<ol>
  <li>Go to the <a href="https://docs.mongodb.com/manual/">MongoDB manual</a> &gt; Release Notes &gt; Current version of MongoDB &gt; Upgrade or Downgrade Standalone</li>
  <li>Follow the directions listed there. You can access the MongoDB console by running <code class="highlighter-rouge">docker exec -it mongodb mongo</code> on the server.</li>
  <li>During the steps for install or replace binaries or restarting MongoDB, instead change the version in your <code class="highlighter-rouge">mup.js</code> and run <code class="highlighter-rouge">mup setup</code>.</li>
  <li>To verify that it worked, run <code class="highlighter-rouge">docker ps</code> to check if MongoDB keeps restarting. If it is, you can see what the problem is with <code class="highlighter-rouge">docker logs mongodb</code></li>
</ol>

<h2 id="hooks">Hooks</h2>

<p>Hooks allow you to run a command or function before or after a CLI command is run. The config looks like:</p>

<div class="language-js highlighter-rouge"><pre class="highlight"><code><span class="kr">const</span> <span class="nx">childProcess</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'child_process'</span><span class="p">);</span>

<span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="p">{</span>
  <span class="na">hooks</span><span class="p">:</span> <span class="p">{</span>
    <span class="na">hookName</span><span class="p">:</span> <span class="p">{</span>
      <span class="na">localCommand</span><span class="p">:</span> <span class="s1">'command to run on computer'</span><span class="p">,</span>
      <span class="na">remoteCommand</span><span class="p">:</span> <span class="s1">'command to run on every server'</span>
    <span class="p">},</span>
    <span class="s1">'pre.deploy'</span><span class="p">:</span> <span class="p">{</span>
      <span class="na">localCommand</span><span class="p">:</span> <span class="s1">'npm prune --production'</span>
    <span class="p">},</span>
    <span class="s1">'post.meteor.restart'</span><span class="p">:</span> <span class="p">{</span>
      <span class="na">remoteCommand</span><span class="p">:</span> <span class="s1">'docker logs --tail 50 app-name'</span>
    <span class="p">},</span>
    <span class="s1">'pre.reconfig'</span><span class="p">(</span><span class="nx">api</span><span class="p">)</span> <span class="p">{</span>
      <span class="c1">// Same api as is given to plugin command handlers</span>
      <span class="c1">// If this runs asynchronous tasks, it needs to return a promise.</span>
      <span class="kr">const</span> <span class="nx">gitHash</span> <span class="o">=</span> <span class="nx">childProcess</span><span class="p">.</span><span class="nx">execSync</span><span class="p">(</span><span class="s1">'git rev-parse HEAD'</span><span class="p">).</span><span class="nx">toString</span><span class="p">().</span><span class="nx">trim</span><span class="p">();</span>

      <span class="nx">api</span><span class="p">.</span><span class="nx">getSettings</span><span class="p">();</span>
      <span class="nx">api</span><span class="p">.</span><span class="nx">settings</span><span class="p">.</span><span class="nx">GIT_HASH</span> <span class="o">=</span> <span class="nx">gitHash</span><span class="p">;</span>
    <span class="p">},</span>
    <span class="s1">'post.docker.setup'</span><span class="p">(</span><span class="nx">api</span><span class="p">)</span> <span class="p">{</span>
      <span class="c1">// Login to private Gitlab docker registry</span>
      <span class="kr">const</span> <span class="nx">config</span> <span class="o">=</span> <span class="nx">api</span><span class="p">.</span><span class="nx">getConfig</span><span class="p">();</span>
      <span class="kr">const</span> <span class="nx">registry</span> <span class="o">=</span> <span class="s1">'registry.gitlab.com'</span><span class="p">;</span>
      <span class="kr">const</span> <span class="nx">username</span> <span class="o">=</span> <span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">REGISTRY_USERNAME</span><span class="p">;</span>
      <span class="kr">const</span> <span class="nx">password</span> <span class="o">=</span> <span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">REGISTRY_PASSWORD</span><span class="p">;</span>

      <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">username</span> <span class="o">||</span> <span class="o">!</span><span class="nx">password</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span><span class="p">(</span>
          <span class="s1">'You must provide registry login details'</span>
        <span class="p">);</span>
      <span class="p">}</span>

      <span class="k">return</span> <span class="nx">api</span><span class="p">.</span><span class="nx">runSSHCommand</span><span class="p">(</span>
        <span class="nx">config</span><span class="p">.</span><span class="nx">servers</span><span class="p">.</span><span class="nx">one</span><span class="p">,</span>
        <span class="err">`</span><span class="nx">docker</span> <span class="nx">login</span> <span class="o">-</span><span class="nx">u</span> <span class="nx">$</span><span class="p">{</span><span class="nx">username</span><span class="p">}</span> <span class="o">-</span><span class="nx">p</span> <span class="nx">$</span><span class="p">{</span><span class="nx">password</span><span class="p">}</span> <span class="nx">$</span><span class="p">{</span><span class="nx">registry</span><span class="p">}</span><span class="err">`</span>
      <span class="p">);</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">};</span>
</code></pre>
</div>

<p>The hook name format is <code class="highlighter-rouge"><span class="p">{</span><span class="err">pre</span><span class="w"> </span><span class="err">or</span><span class="w"> </span><span class="err">post</span><span class="p">}</span><span class="err">.topLevelCommand.subCommand</span></code>. For example, if you want a command to run after <code class="highlighter-rouge">mup deploy</code>, the hook name would be <code class="highlighter-rouge">post.deploy</code>. Or if you want it to run after <code class="highlighter-rouge">mup mongo restart</code>, the hook name would be <code class="highlighter-rouge">post.mongo.restart</code>.</p>

<p>Some CLI commands run other CLI commands. For example, <code class="highlighter-rouge">mup setup</code> runs <code class="highlighter-rouge">mup docker setup</code> and <code class="highlighter-rouge">mup mongo setup</code>. To see all of the available hooks while a command runs, use the <code class="highlighter-rouge">--show-hook-names</code> option.</p>

<h2 id="updating-mup">Updating Mup</h2>

<p>To update <code class="highlighter-rouge">mup</code> to the latest version, just type:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>npm install -g mup
</code></pre>
</div>

<p>mup usually will let you know when there is an update available. You should try and keep <code class="highlighter-rouge">mup</code> up to date in order to keep up with the latest Meteor changes.</p>

<h2 id="troubleshooting">Troubleshooting</h2>

<h3 id="check-logs">Check Logs</h3>
<p>If you suddenly canâ€™t deploy your app anymore, first use the <code class="highlighter-rouge">mup logs -f</code> command to check the logs for error messages.</p>

<p>You can also view logs for:</p>
<ul>
  <li>Built-in MongoDB with <code class="highlighter-rouge">mup mongo logs</code></li>
  <li>Reverse proxy with <code class="highlighter-rouge">mup proxy logs</code></li>
  <li>Letâ€™s Encrypt with <code class="highlighter-rouge">mup proxy logs-le</code></li>
</ul>

<h3 id="run-mup-status">Run mup status</h3>

<p><code class="highlighter-rouge">mup status</code> checks the servers for any potential problems, as well as shows you the status of any docker containers or services running on the servers.</p>

<h3 id="docker-image">Docker image</h3>
<p>Make sure that the docker image you are using supports your appâ€™s meteor version.</p>

<h3 id="update-docker">Update Docker</h3>
<p>Some problems are caused by old versions of docker. Since mup 1.3, <code class="highlighter-rouge">mup setup</code> and <code class="highlighter-rouge">mup docker setup</code> will update Docker if it is older than 1.13.</p>

<h3 id="check-if-docker-containers-are-restarting">Check if Docker Containers are Restarting</h3>
<p>You can view a list of Docker containers with</p>
<div class="language-bash highlighter-rouge"><pre class="highlight"><code>mup docker ps
</code></pre>
</div>

<p>and check the <code class="highlighter-rouge">STATUS</code> column.</p>

<h3 id="verbose-output">Verbose Output</h3>
<p>If you need to see the output of <code class="highlighter-rouge">mup</code> (to see more precisely where itâ€™s failing or hanging, for example), run it like so:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>DEBUG=mup* mup &lt;command&gt; --verbose
</code></pre>
</div>

<p>where <code class="highlighter-rouge">&lt;command&gt;</code> is one of the <code class="highlighter-rouge">mup</code> commands such as <code class="highlighter-rouge">setup</code>, <code class="highlighter-rouge">deploy</code>, etc.</p>

<p>The environment variable <code class="highlighter-rouge">DEBUG=mup*</code> gives more information on what the <code class="highlighter-rouge">mup</code> CLI is doing.</p>

<p>The <code class="highlighter-rouge">--verbose</code> flag shows output from commands and scripts run on the server.</p>

<h2 id="common-problems">Common Problems</h2>

<h3 id="verifying-deployment-failed">Verifying Deployment: FAILED</h3>

<p>If you do not see <code class="highlighter-rouge">=&gt; Starting meteor app on port</code> in the logs, your app did not have enough time to start. Try increase <code class="highlighter-rouge">meteor.deployCheckWaitTime</code>. This only applies if <code class="highlighter-rouge">Prepare Bundle</code> is disabled.</p>

<p>If you do see it in your logs, make sure your <code class="highlighter-rouge">ROOT_URL</code> starts with https or http, depending on if you are using SSL or not. If that did not fix it, create a new issue with your config and output from <code class="highlighter-rouge">mup deploy --verbose</code>.</p>

<p>If you are using Meteor 1.3, you might see this error:</p>
<div class="highlighter-rouge"><pre class="highlight"><code>/bundle/bundle/programs/server/node_modules/fibers/future.js:280
						throw(ex);
						^

ReferenceError: module is not defined
    at app/mup.js:1:-27
</code></pre>
</div>

<p>This error happens when your config gets bundled with the app. Try moving it and your <code class="highlighter-rouge">settings.json</code> to a hidden folder (such as <code class="highlighter-rouge">app/.deploy</code>) or to a location outside of the appâ€™s folder.</p>

<h3 id="mup-silently-fails-mupjs-file-opens-instead-or-you-get-a-windows-script-error">Mup silently fails, mup.js file opens instead, or you get a Windows script error</h3>

<p>If you are using Windows, make sure you run commands with <code class="highlighter-rouge">mup.cmd &lt;command&gt;</code> instead of <code class="highlighter-rouge">mup &lt;command&gt;</code>, or use PowerShell.
If it silently fails for a different reason, please create an issue.</p>

<h3 id="error-spawn-meteor-enoent">Error: spawn meteor ENOENT</h3>

<p>Make sure meteor is installed on the computer you are deploying from.</p>

<h3 id="lets-encrypt-is-not-working">Letâ€™s Encrypt is not working</h3>

<p>Make sure your <code class="highlighter-rouge">meteor.env.ROOT_URL</code> starts with <code class="highlighter-rouge">https://</code>. Also, check that the DNS for all of the domains in <code class="highlighter-rouge">ssl.autogenerate.domains</code> is correctly configured to point to the server. Port 80 needs to be open on the server so it can verify that you control the domain.</p>

<p>You can view the Letâ€™s Encrypt logs by running this command on the server:</p>
<div class="highlighter-rouge"><pre class="highlight"><code>docker logs &lt;AppName&gt;-nginx-letsencrypt
</code></pre>
</div>
<p>Replace <code class="highlighter-rouge">&lt;AppName&gt;</code> with the name of the app.</p>

<h3 id="prepare-bundle-ends-with-killed">Prepare Bundle ends with <code class="highlighter-rouge">Killed</code></h3>

<p>The server ran out of memory during <code class="highlighter-rouge">npm install</code>. Try increasing the serverâ€™s ram or creating a swap file.</p>

<h3 id="unwanted-redirects-to-https">Unwanted redirects to https</h3>

<p>Make sure <code class="highlighter-rouge">force-ssl</code> is not in <code class="highlighter-rouge">.meteor/versions</code>. If it is, either your app or a package it uses has <code class="highlighter-rouge">force-ssl</code> as a dependency.</p>

<h2 id="migration-guide">Migration Guide</h2>
<p><code class="highlighter-rouge">mup</code> is not backward compatible with Meteor Up 0.x. or <code class="highlighter-rouge">mupx</code>.</p>

<ul>
  <li>Docker is now the runtime for Meteor Up</li>
  <li>We donâ€™t have to use Upstart anymore</li>
  <li>You donâ€™t need to set up NodeJS version or PhantomJS manually (MeteorD will take care of it)</li>
  <li>We use a mongodb docker container to run the local MongoDB data (it uses the old MongoDB location)</li>
  <li>It uses Nginx and different SSL configurations</li>
  <li>Now we donâ€™t re-build binaries. Instead, we build for the <code class="highlighter-rouge">os.linux.x86_64</code> architecture. (This is the same thing what meteor-deploy does)</li>
</ul>

<blockquote>
  <p>Use a new server if you can. Then migrate DNS accordingly. Thatâ€™s the easiest and safest way.</p>
</blockquote>

<h3 id="migrating-from-mupx">Migrating from Mupx</h3>

<p>Letâ€™s assume our appName is <code class="highlighter-rouge">meteor</code></p>

<p>Remove old docker container with <code class="highlighter-rouge">docker rm -f meteor</code>
Remove old mongodb container with <code class="highlighter-rouge">docker rm -f mongodb</code>
If present remove nginx container with <code class="highlighter-rouge">docker rm -f meteor-frontend</code></p>

<p>The new config format is different from mupx.
Run <code class="highlighter-rouge">mup init</code> to create a new config file.
Then do <code class="highlighter-rouge">mup setup</code> and then <code class="highlighter-rouge">mup deploy</code>.</p>


        </div>
        <div class="docs-nav-wrapper">
            <div class="close hidden-xs hidden-sm hidden-md hidden-lg">&times;</div>
              <div class="docs-nav col-sm-3 col-sm-pull-9 col-xs-12 hidden-xs"></div>

        </div>
    </div>
    <script src="/scripts/tocbot.min.js"></script>
    <script>
        document.querySelector('.docs-nav-wrapper .close').addEventListener('click', () => {
            document.querySelector('.docs-nav').className += ' hidden-xs';
            document.querySelector('.docs-nav-wrapper .close').className += ' hidden-xs';
        });

        document.querySelector('.docs-content .show-menu').addEventListener('click', () => {
            document.querySelector('.docs-nav').classList.remove('hidden-xs');
            document.querySelector('.docs-nav-wrapper .close').classList.remove('hidden-xs');
        });
        tocbot.init({
            // Where to render the table of contents.
            tocSelector: '.docs-nav',
            // Where to grab the headings to build the table of contents.
            contentSelector: '.docs-content',
            // Which headings to grab inside of the contentSelector element.
            headingSelector: 'h1, h2, h3',
            positionFixedSelector: '.docs-nav'
        });
    </script>
</body>

</html>