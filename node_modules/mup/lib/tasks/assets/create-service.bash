#!/bin/bash
set -e

APP_NAME=<%= appName %>
APP_PATH=/opt/$APP_NAME
PORT=<%= port %>
EXPOSED_PORT=<%= exposedPort %>
ENV_FILE=$APP_PATH/config/env.list
IMAGE=mup-<%= appName.toLowerCase() %>:latest

docker service create \
  --publish=$PORT:3000 \
  --env-file=$ENV_FILE \
  --name $APP_NAME \
  --hostname="$HOSTNAME-$APP_NAME" \
  --publish=$PORT:$EXPOSED_PORT \
  --replicas=2 \
  $IMAGE

