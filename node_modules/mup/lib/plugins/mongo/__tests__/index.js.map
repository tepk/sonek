{"version":3,"sources":["../../../../src/plugins/mongo/__tests__/index.js"],"names":["servers","require","sh","config","silent","timeout","cd","path","resolve","os","tmpdir","exec","out","code","to","be","equal","output","serverInfo","mymongo","sshOut","expect"],"mappings":"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","file":"index.js","sourcesContent":["import { countOccurences, runSSHCommand } from '../../../utils';\nimport { describe, it } from 'mocha';\nimport { expect } from 'chai';\nimport os from 'os';\nimport path from 'path';\nimport sh from 'shelljs';\nconst servers = require('../../../../tests/fixtures/servers');\n\nsh.config.silent = false;\n\ndescribe('module - mongo', function() {\n  this.timeout(600000);\n\n  describe('logs', () => {\n    it('should pull logs from \"meteor\" vm', async () => {\n      sh.cd(path.resolve(os.tmpdir(), 'tests/project-1'));\n\n      sh.exec('mup setup');\n      const out = sh.exec('mup mongo logs');\n\n      expect(out.code).to.be.equal(0);\n      expect(countOccurences('MongoDB starting :', out.output)).to.be.equal(1);\n      expect(countOccurences('db version', out.output)).to.be.equal(1);\n    });\n  });\n\n  describe('setup', () => {\n    it('should setup mongodb on \"mongo\" vm', async () => {\n      const serverInfo = servers.mymongo;\n      sh.cd(path.resolve(os.tmpdir(), 'tests/project-1'));\n\n      const out = sh.exec('mup mongo setup');\n      expect(out.code).to.be.equal(0);\n\n      expect(\n        countOccurences('Setup Environment: SUCCESS', out.output)\n      ).to.be.equal(1);\n      expect(\n        countOccurences('Copying mongodb.conf: SUCCESS', out.output)\n      ).to.be.equal(1);\n\n      const sshOut = await runSSHCommand(serverInfo, 'tree -pufi /opt');\n      expect(sshOut.code).to.be.equal(0);\n      expect(countOccurences('mongodb.conf', sshOut.output)).to.be.equal(1);\n    });\n  });\n\n  describe('start', () => {\n    it('should start mongodb on \"mongo\" vm', async () => {\n      const serverInfo = servers.mymongo;\n\n      sh.cd(path.resolve(os.tmpdir(), 'tests/project-1'));\n      sh.exec('mup docker setup && mup mongo setup');\n\n      const out = sh.exec('mup mongo start');\n      expect(out.code).to.be.equal(0);\n\n      expect(countOccurences('Start Mongo: SUCCESS', out.output)).to.be.equal(\n        1\n      );\n      expect(\n        (await runSSHCommand(serverInfo, 'nc -z -v -w5 localhost 27017')).code\n      ).to.be.equal(0);\n    });\n  });\n\n  describe('stop', () => {\n    it('should stop mongodb on \"mongo\" vm', async () => {\n      const serverInfo = servers.mymongo;\n\n      sh.cd(path.resolve(os.tmpdir(), 'tests/project-1'));\n      sh.exec('mup docker setup && mup mongo setup && mup mongo start');\n\n      const out = sh.exec('mup mongo stop');\n      expect(out.code).to.be.equal(0);\n\n      expect(countOccurences('stop mongo: SUCCESS', out.output)).to.be.equal(1);\n      expect(\n        (await runSSHCommand(serverInfo, 'nc -z -v -w5 localhost 27017')).code\n      ).to.be.equal(1);\n    });\n  });\n});\n"]}