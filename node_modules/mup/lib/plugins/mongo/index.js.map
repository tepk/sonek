{"version":3,"sources":["../../../src/plugins/mongo/index.js"],"names":["prepareConfig","_commands","description","commands","validate","mongo","_validator","config","app","env","MONGO_URL","name","split","join","docker","args","push","hooks","api","getConfig","runCommand","then"],"mappings":";;;;;;QASgBA,a,GAAAA,a;;AAThB;;IAAYC,S;;AACZ;;;;;;;;AAEO,IAAMC,oCAAc,4BAApB;AACA,IAAMC,8BAAWF,SAAjB;AACA,IAAMG,8BAAW;AACtBC,SAAOC;AADe,CAAjB;;AAIA,SAASN,aAAT,CAAuBO,MAAvB,EAA+B;AACpC,MAAI,CAACA,OAAOC,GAAR,IAAe,CAACD,OAAOF,KAA3B,EAAkC;AAChC,WAAOE,MAAP;AACD;;AAEDA,SAAOC,GAAP,CAAWC,GAAX,GAAiBF,OAAOC,GAAP,CAAWC,GAAX,IAAkB,EAAnC;AACAF,SAAOC,GAAP,CAAWC,GAAX,CAAeC,SAAf,gCAAsDH,OAAOC,GAAP,CAAWG,IAAX,CAAgBC,KAAhB,CAAsB,GAAtB,EAA2BC,IAA3B,CAAgC,EAAhC,CAAtD;;AAEA,MAAI,CAACN,OAAOC,GAAP,CAAWM,MAAhB,EAAwB;AACtBP,WAAOC,GAAP,CAAWM,MAAX,GAAoB,EAApB;AACD;;AAED,MAAI,CAACP,OAAOC,GAAP,CAAWM,MAAX,CAAkBC,IAAvB,EAA6B;AAC3BR,WAAOC,GAAP,CAAWM,MAAX,CAAkBC,IAAlB,GAAyB,EAAzB;AACD;;AAEDR,SAAOC,GAAP,CAAWM,MAAX,CAAkBC,IAAlB,CAAuBC,IAAvB,CAA4B,wBAA5B;;AAEA,SAAOT,MAAP;AACD;;AAEM,IAAMU,wBAAQ;AACnB,sBADmB,4BACEC,GADF,EACO;AACxB,QAAMX,SAASW,IAAIC,SAAJ,EAAf;AACA,QAAIZ,OAAOF,KAAX,EAAkB;AAChB,aAAOa,IAAIE,UAAJ,CAAe,aAAf,EAA8BC,IAA9B,CAAmC;AAAA,eAAMH,IAAIE,UAAJ,CAAe,aAAf,CAAN;AAAA,OAAnC,CAAP;AACD;AACF,GANkB;AAOnB,uBAPmB,6BAOGF,GAPH,EAOQ;AACzB,QAAMX,SAASW,IAAIC,SAAJ,EAAf;AACA,QAAIZ,OAAOF,KAAX,EAAkB;AAChB,aAAOa,IAAIE,UAAJ,CAAe,cAAf,CAAP;AACD;AACF;AAZkB,CAAd","file":"index.js","sourcesContent":["import * as _commands from './commands';\nimport _validator from './validate';\n\nexport const description = 'Commands to manage MongoDB';\nexport const commands = _commands;\nexport const validate = {\n  mongo: _validator\n};\n\nexport function prepareConfig(config) {\n  if (!config.app || !config.mongo) {\n    return config;\n  }\n\n  config.app.env = config.app.env || {};\n  config.app.env.MONGO_URL = `mongodb://mongodb:27017/${config.app.name.split('.').join('')}`;\n\n  if (!config.app.docker) {\n    config.app.docker = {};\n  }\n\n  if (!config.app.docker.args) {\n    config.app.docker.args = [];\n  }\n\n  config.app.docker.args.push('--link=mongodb:mongodb');\n\n  return config;\n}\n\nexport const hooks = {\n  'post.default.setup'(api) {\n    const config = api.getConfig();\n    if (config.mongo) {\n      return api.runCommand('mongo.setup').then(() => api.runCommand('mongo.start'));\n    }\n  },\n  'post.default.status'(api) {\n    const config = api.getConfig();\n    if (config.mongo) {\n      return api.runCommand('mongo.status');\n    }\n  }\n};\n"]}