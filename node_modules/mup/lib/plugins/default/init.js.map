{"version":3,"sources":["../../../src/plugins/default/init.js"],"names":["init","log","sh","config","silent","findDestination","api","base","process","cwd","inMeteorApp","fs","existsSync","resolvePath","parentMeteorApp","parentChildren","readdirSync","siblingMeteorApp","otherChild","length","filter","child","path","basename","dest","appPath","createFolder","createDeployFolder","folderPath","mkdirSync","configSource","__dirname","settingsSource","settingsDest","configDest","configExists","settingsExist","console","cp","configContents","readFileSync","toString","replace","writeFileSync"],"mappings":"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","file":"init.js","sourcesContent":["import debug from 'debug';\nimport fs from 'fs';\nimport path from 'path';\nimport sh from 'shelljs';\n\nconst log = debug('mup:init');\n\nsh.config.silent = true;\n\nfunction findDestination(api) {\n  const base = process.cwd();\n\n  const inMeteorApp = fs.existsSync(api.resolvePath(base, '.meteor/release'));\n  const parentMeteorApp = fs.existsSync(api.resolvePath(base, '../.meteor/release'));\n  const parentChildren = fs.readdirSync(api.resolvePath(base, '../'));\n  let siblingMeteorApp = false;\n  let otherChild = '';\n\n  if (parentChildren.length === 2) {\n    otherChild = parentChildren\n      .filter(child => child !== path.basename(base))[0];\n    if (fs.existsSync(api.resolvePath('..', otherChild, '.meteor/release'))) {\n      siblingMeteorApp = true;\n    }\n  }\n\n  log('in meteor app', inMeteorApp);\n  log('Parent Meteor app', parentMeteorApp);\n  log('siblingMeteorApp', siblingMeteorApp);\n\n  let dest = base;\n  let appPath = './';\n  let createFolder = false;\n\n  if (inMeteorApp) {\n    dest = api.resolvePath(base, '.deploy');\n    appPath = '../';\n    createFolder = true;\n  } else if (parentMeteorApp) {\n    dest = base;\n    appPath = '../';\n  } else if (siblingMeteorApp) {\n    dest = base;\n    appPath = `../${otherChild}`;\n  }\n\n  return {\n    appPath,\n    dest,\n    createFolder\n  };\n}\n\nfunction createDeployFolder(api) {\n  const base = process.cwd();\n  const folderPath = api.resolvePath(base, '.deploy');\n  if (!fs.existsSync(folderPath)) {\n    fs.mkdirSync(folderPath);\n  }\n}\n\nexport default function init(api) {\n  const configSource = api.resolvePath(__dirname, 'template/mup.js.sample');\n  const settingsSource = api.resolvePath(__dirname, 'template/settings.json');\n\n  const { appPath, dest, createFolder } = findDestination(api);\n\n  const settingsDest = api.resolvePath(dest, 'settings.json');\n  const configDest = api.resolvePath(dest, 'mup.js');\n\n  const configExists = fs.existsSync(api.resolvePath(configDest));\n  const settingsExist = fs.existsSync(settingsDest);\n\n  if (createFolder) {\n    createDeployFolder(api);\n    console.log('Created .deploy folder');\n  }\n\n  if (!settingsExist) {\n    sh.cp(settingsSource, settingsDest);\n    console.log(`Created settings.json at ${settingsDest}`);\n  } else {\n    console.log('Skipping creation of settings.json.');\n    console.log(`settings.json already exists at ${settingsDest}`);\n  }\n\n  if (!configExists) {\n    const configContents = fs.readFileSync(configSource).toString()\n      .replace('<app path>', appPath);\n    fs.writeFileSync(configDest, configContents);\n\n    console.log(`Created mup.js at ${configDest}`);\n    console.log('');\n    console.log('Next Steps:');\n    console.log('');\n    console.log('  Open mup.js and edit the config to meet your needs.');\n    console.log('  Required changes have been marked with a TODO comment.');\n    console.log('');\n    console.log('  Available options can be found in the docs at');\n    console.log('    https://github.com/zodern/meteor-up');\n    console.log('');\n    console.log('  Then, run the command:');\n    console.log('    mup setup');\n  } else {\n    console.log('Skipping creation of mup.js');\n    console.log(`mup.js already exists at ${configDest}`);\n  }\n}\n"]}