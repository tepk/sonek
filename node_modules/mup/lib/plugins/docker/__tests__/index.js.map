{"version":3,"sources":["../../../../src/plugins/docker/__tests__/index.js"],"names":["sh","config","silent","servers","require","timeout","checkDocker","name","serverInfo","cd","os","tmpdir","out","exec","assert","equal","code","num","output","sshOut"],"mappings":";;AAAA;;AACA;;AACA;;;;AACA;;;;AACA;;;;;;;;AAEAA,kBAAGC,MAAH,CAAUC,MAAV,GAAmB,KAAnB;AACA,IAAMC,UAAUC,QAAQ,oCAAR,CAAhB;;AAEA,qBAAS,iBAAT,EAA4B,YAAW;AACrC,OAAKC,OAAL,CAAa,OAAb;;AAEA,uBAAS,OAAT,EAAkB,YAAM;AACtB;AACA;AACA;AACA,aAASC,WAAT,CAAqBC,IAArB,EAA2B;AACzB;AACA,UAAMC,aAAaL,eAAaI,IAAb,CAAnB;;AAEA,qEAAO;AAAA;AAAA;AAAA;AAAA;AAAA;AACL,qBAAKF,OAAL,CAAa,KAAb;;AAEAL,kCAAGS,EAAH,CAAM,wBAAYC,aAAGC,MAAH,EAAZ,EAAyB,iBAAzB,CAAN;AACMC,mBAJD,GAIOZ,kBAAGa,IAAH,CAAQ,kBAAR,CAJP;;AAKLC,iCAAOC,KAAP,CAAaH,IAAII,IAAjB,EAAuB,CAAvB;;AAEMC,mBAPD,GAOO,4BAAgB,uBAAhB,EAAyCL,IAAIM,MAA7C,CAPP;;AAQLJ,iCAAOC,KAAP,CAAaE,GAAb,EAAkB,CAAlB;;AARK;AAAA,uBAUgB,0BAAcT,UAAd,EAA0B,cAA1B,CAVhB;;AAAA;AAUCW,sBAVD;;AAWLL,iCAAOC,KAAP,CAAaI,OAAOH,IAApB,EAA0B,CAA1B;;AAXK;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,OAAP;AAaD;;AAED,mBAAG,sCAAH,EAA2CV,YAAY,QAAZ,CAA3C;AACA,mBAAG,qCAAH,EAA0CA,YAAY,OAAZ,CAA1C;AACA,mBAAG,qCAAH,EAA0CA,YAAY,OAAZ,CAA1C;AACD,GA1BD;AA2BD,CA9BD","file":"index.js","sourcesContent":["import { countOccurences, resolvePath, runSSHCommand } from '../../../utils';\nimport { describe, it } from 'mocha';\nimport assert from 'assert';\nimport os from 'os';\nimport sh from 'shelljs';\n\nsh.config.silent = false;\nconst servers = require('../../../../tests/fixtures/servers');\n\ndescribe('module - docker', function() {\n  this.timeout(6000000);\n\n  describe('setup', () => {\n    // reuse this function for 3 tests below\n    // TODO break this into multiple functions\n    // so parts can be used for other tests\n    function checkDocker(name) {\n      // TODO get server name form mup.js file\n      const serverInfo = servers[`my${name}`];\n\n      return async function() {\n        this.timeout(60000);\n\n        sh.cd(resolvePath(os.tmpdir(), 'tests/project-1'));\n        const out = sh.exec('mup docker setup');\n        assert.equal(out.code, 0);\n\n        const num = countOccurences('Setup Docker: SUCCESS', out.output);\n        assert.equal(num, 1);\n\n        const sshOut = await runSSHCommand(serverInfo, 'which docker');\n        assert.equal(sshOut.code, 0);\n      };\n    }\n\n    it('should install docker on \"meteor\" vm', checkDocker('meteor'));\n    it('should install docker on \"mongo\" vm', checkDocker('mongo'));\n    it('should install docker on \"proxy\" vm', checkDocker('proxy'));\n  });\n});\n"]}